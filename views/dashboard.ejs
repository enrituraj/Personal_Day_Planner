<%- include('partials/navbar.ejs')%>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<style>
  .flatpickr-calendar {
    background-color: #f9fafb; /* Light background */
    border: 1px solid #d1d5db; /* Gray border */
    border-radius: 0.5rem; /* Rounded corners */
    padding: 1rem; /* Inner padding */
  }
</style>
<div class="flex justify-between mt-8">
  <!-- Calendar -->
  <div class="w-1/2 p-5">
    <h2 class="text-xl font-semibold mb-4">Select a Date</h2>
    <div id="calendar_view"></div>
  </div>

  <!-- Tasks -->
  <div class="w-1/2">
    <h2 class="text-xl font-semibold mb-4">Tasks for <%= currentDate %></h2>

    <ul class="list-disc list-inside mb-4">
      <% if (tasks.length > 0) { %>
        <% tasks.forEach(task => { %>
          <li>
            <strong><%= task.title %></strong>: <%= task.description %>
          </li>
        <% }) %>
      <% } else { %>
        <p>No tasks for this day</p>


        
      <% } %>
    </ul>

    <!-- Add Task Form -->
    <h3 class="text-lg font-semibold mb-2">Add a Task</h3>
    <form action="/dashboard/task" method="POST" class="mb-4">
      <input type="hidden" name="date" value="<%= currentDate %>">
      <div class="mb-2">
        <input type="text" name="title" placeholder="Task Title" class="w-full p-2 border border-gray-300" required>
      </div>
      <div class="mb-2">
        <textarea name="description" placeholder="Task Description" class="w-full p-2 border border-gray-300" required></textarea>
      </div>
      <button type="submit" class="bg-blue-500 text-white p-2 rounded">Add Task</button>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    flatpickr("#calendar_view", {
      inline: true,
      onReady: function(selectedDates, dateStr, instance) {
        // Custom Tailwind classes to Flatpickr elements
        instance.calendarContainer.classList.add("bg-gray-100", "p-4", "rounded-lg", "shadow-md");
        document.querySelectorAll(".flatpickr-day").forEach(day => {
          day.classList.add("hover:bg-blue-100", "text-gray-800", "rounded-md");
        });
      },
      defaultDate: "<%= currentDate %>", // Set the default date
      onChange: function(selectedDates, dateStr) {
        // console.log("Selected date: ", dateStr);
        
        const selectedDate = dateStr;
        window.location.href = `/dashboard?date=${selectedDate}`;
        },
    });
  });
</script>